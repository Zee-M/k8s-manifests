version: '3.8'
networks:
  kong-net:
    driver: bridge
services:
    kong:
      image: kong:2.4.1-alpine
      container_name: kong_nodb
      networks:
        - kong-net
      environment:
        KONG_DATABASE: "off"
        KONG_DECLARATIVE_CONFIG: "/etc/kong/kong.yaml"
        KONG_ADMIN_ERROR_LOG: "/dev/stderr"
        KONG_ADMIN_LISTEN: "0.0.0.0:8001, 0.0.0.0:8444 ssl"
        KONG_PROXY_ERROR_LOG: "/dev/stderr"
        KONG_ADMIN_ACCESS_LOG: "/dev/stdout"
        KONG_PROXY_ACCESS_LOG: "/dev/stdout"   
      healthcheck:
        test: ["CMD", "kong", "health"]
        interval: 5s
        timeout: 2s
        retries: 15
      volumes:
        - ./kong.yml:/etc/kong/kong.yaml
      ports:
        - 8000:8000
        - 8001:8001
        - 8443:8443
        - 8444:8444
 
    chkk-service:
      image: 033121473579.dkr.ecr.us-west-2.amazonaws.com/chkk-demo:v0.2
      container_name: chkk-service-container-test
      networks:
        - kong-net
      ports:
        - 80:80
      expose:
        - 80
